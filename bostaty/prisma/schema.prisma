generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
  
}

datasource db {
  provider = "postgresql"
}

////////////////////
// ENUMS
////////////////////

enum TenantRole {
  OWNER
  ADMIN
  MEMBER
}

////////////////////
// USERS
////////////////////

model User {
  id        String   @id @default(uuid()) @db.Uuid
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
isSuperAdmin Boolean  @default(false)
  // Relations
  memberships TenantMember[]
  invitations TenantInvitation[] // As inviter

  @@map("users")
}

////////////////////
// TENANTS
////////////////////

model Tenant {
  id        String   @id @default(uuid())
  name      String
  slug      String   @unique
  subdomain String   @unique
  plan      String   @default("free")
 settings    Json?    @default("{}")
  enabledModules String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  members     TenantMember[]
  invitations TenantInvitation[]

  @@map("tenants")
}

////////////////////
// TENANT MEMBERS (JOIN TABLE)
////////////////////

model TenantMember {
  id        String     @id @default(uuid())
  tenantId  String
  userId    String     @db.Uuid
  role      TenantRole @default(MEMBER)
  metadata  Json?      @default("{}")
  createdAt DateTime   @default(now())

  // Relations
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId])
  @@map("tenant_members")
}

////////////////////
// TENANT INVITATIONS
////////////////////

model TenantInvitation {
  id        String     @id @default(uuid())
  email     String
  token     String     @unique
  role      TenantRole @default(MEMBER)
  tenantId  String
  inviterId String?    @db.Uuid
  metadata  Json?      @default("{}")
  expiresAt DateTime
  createdAt DateTime   @default(now())
  acceptedAt DateTime?
  // Relations
  tenant  Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  inviter User?  @relation(fields: [inviterId], references: [id], onDelete: SetNull)

  @@unique([tenantId, email])
  @@map("tenant_invitations")
}

model Employee {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  email       String
  position    String
  department  String
  salary      Float?   // We'll use this to show "Sensitive Data" permission logic
  status      String   @default("ACTIVE") // ACTIVE, INACTIVE, ON_LEAVE
  
  // Multi-tenancy
  tenantId    String
  tenant      Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([tenantId])
}

model AuditLog {
  id        String   @id @default(uuid())
  action    String   // e.g., "CREATE_EMPLOYEE", "DELETE_USER"
  entity    String   // e.g., "Employee", "Product"
  entityId  String?  // The ID of the thing that was changed
  details   Json?    // Store "before" and "after" states if needed
  
  // Who did it?
  userId    String   @db.Uuid
  user      User     @relation(fields: [userId], references: [id])

  // Which tenant?
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([userId])
}