generator client {
  provider = "prisma-client-js"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

////////////////////
// ENUMS
////////////////////

enum TenantRole {
  OWNER
  ADMIN
  MEMBER
}

////////////////////
// USERS
////////////////////

model User {
  id           String             @id @default(uuid()) @db.Uuid
  email        String             @unique
  name         String?
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  isSuperAdmin Boolean            @default(false)
  // Relations
  memberships  TenantMember[]
  invitations  TenantInvitation[] // As inviter
  auditLogs    AuditLog[]

  @@map("users")
}

////////////////////
// TENANTS
////////////////////

model Tenant {
  id             String   @id @default(uuid())
  name           String
  slug           String   @unique
  subdomain      String   @unique
  plan           String   @default("free")
  settings       Json?    @default("{}")
  enabledModules String[] @default([])
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  members     TenantMember[]
  invitations TenantInvitation[]
  employees   Employee[]
  auditLogs   AuditLog[]

  @@map("tenants")
}

////////////////////
// TENANT MEMBERS 
////////////////////

model TenantMember {
  id        String     @id @default(uuid())
  tenantId  String
  userId    String     @db.Uuid
  role      TenantRole @default(MEMBER)
  metadata  Json?      @default("{}")
  createdAt DateTime   @default(now())

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  tenant Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, userId])
  @@map("tenant_members")
}

////////////////////
// TENANT INVITATIONS
////////////////////

model TenantInvitation {
  id         String     @id @default(uuid())
  email      String
  token      String     @unique
  role       TenantRole @default(MEMBER)
  tenantId   String
  inviterId  String?    @db.Uuid
  metadata   Json?      @default("{}")
  expiresAt  DateTime
  createdAt  DateTime   @default(now())
  acceptedAt DateTime?

  tenant     Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  inviter    User?      @relation(fields: [inviterId], references: [id], onDelete: SetNull)

  @@unique([tenantId, email])
  @@map("tenant_invitations")
}

//////////////////
// EMPLOYEES
//////////////////
model Employee {
  id         String @id @default(uuid())
  firstName  String
  lastName   String
  email      String
  position   String
  department String
  salary     Float? 
  status     String @default("ACTIVE") 

  // Multi-tenancy
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([tenantId])
}


//////////////////
// AUDIT LOGS
//////////////////
model AuditLog {
  id       String  @id @default(uuid())
  action   String 
  entity   String 
  entityId String? 
  details  Json? 


  userId String @db.Uuid
  user   User   @relation(fields: [userId], references: [id])

  
  tenantId String
  tenant   Tenant @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())

  @@index([tenantId])
  @@index([userId])
}
